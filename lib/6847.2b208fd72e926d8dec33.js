"use strict";(self.webpackChunktools_web=self.webpackChunktools_web||[]).push([[6847],{3949:(t,e,i)=>{i.r(e);var e=i(3948),e=i(5069),e=i(4916),e=i(5306),e=i(285),e=i(1637),e=i(7425),d=i.n(e);new(d().Canvas)({container:"#app",props:{data:{value:"中心主题",children:[{value:"主题 1",children:[]}]},style:{backgroundColor:"#ecf4f9",boxBackgroundColor:"#35bffe19",boxBorderColor:"#28beff3d",centralSpacing:50,spacing:26,centralVerticalSpacing:35,verticalSpacing:8,centralTopic:{backgroundColor:"#35455b",color:"#ffffff",fontSize:24,paddingLeft:30,paddingTop:22,paddingBottom:18},mainTopic:{backgroundColor:"#84a1c9",color:"#ffffff",fontSize:18,paddingLeft:18,paddingTop:14,paddingBottom:12},subTopic:{backgroundColor:"#e2e9f1",color:"#35455b",fontSize:14,paddingLeft:7,paddingTop:9,paddingBottom:6},centralLink:{backgroundColor:"#ecf4f9",backgroundMousein:"#d2dbe2",color:"#35455b",lineWidth:3,spacing:13,arcToRadius:8,arcRadius:6,arcRadiusCollapse:8,arcLineLength:8,arcLineWidth:1,font:"10px Open Sans"},mainLink:{lineWidth:2}},point:{_locate:new(d().Point)(0,0),_offset:new(d().Point)(0,0),_before:new(d().Point)(0,0),_delta:new(d().Point)(0,0),_conflict:new(d().Point)(0,0),locate:function(t,e){this._locate.init(t,e)},set:function(t,e){this._offset.init(t,e),this._onOffsetChanged()},add:function(t,e){this._offset.translate(t,e),this._onOffsetChanged()},delta:function(t,e){this._delta.init(t,e)},isDelta:function(){return this._delta.x||this._delta.y},eventdown:function(){this._conflict.init(0,0),this.animation.isRunning()||this.animation.beforeUpdate()},eventmove:function(t,e){this.animation.isRunning()?this._conflict.init(t,e):this.set(this._before.x+t-this._conflict.x,this._before.y+e-this._conflict.y)},_onOffsetChanged:function(){this.onOffsetChanged(this._locate.x+this._offset.x,this._locate.y+this._offset.y)},onOffsetChanged:d().Utils.noop},mouse:{type:0,none:0,left:1,right:2,center:4,back:8,front:16},format:{markdown:{prefix:"- ",suffix:"\n",indent:2,separate:" ",regex:/\r\n(?= )/},xmind:{prefix:"",suffix:"\n",indent:1,separate:"\t",regex:/\r\n(?=\t)/}},topic:function(t){return t?"选项 ":"主题 "}},components:{Node:(h._serialId=0,h.OPERATION={APPENDCHILD:"_appendOperation",REMOVECHILD:"_removeOperation",SETVALUE:"_setValueOperation",COLLAPSE:"_collapseOperation"},h.setOnOperation=function(t){this.prototype.onOperation=t},h.prototype={reset:function(){this.parent=null,this.children.length=0,this.length=0,this.index=0,this.depth=0,this.count=0,this.isMousein=!1,this.isSelected=!1},apply:function(){var t=this.style,e=this.x,i=this.y,s=e-t.borderOffset,n=i-t.borderOffset;this.background.setStart(e,i),this.border.setStart(s,n),this.borderX=s-t._borderOffset,this.borderY=n-t._borderOffset;for(var o=0,h=this.values.length;o<h;o++)this.texts[o].setStart(e+t.paddingLeft,i+t.paddingTop+o*t.lineHeight)},collidesWith:function(t){return d().Collision.rect(this.x,this.y,this.right,this.bottom,t.getLeft(),t.getTop(),t.getRight(),t.getBottom())},draw:function(){this.background.fill(),(this.isMousein||this.isSelected)&&this.border.stroke();for(var t=0,e=this.values.length;t<e;t++)this.texts[t].fill()},appendChild:function(t){this.insertChild(t,this.length)},insertChild:function(t,e){this._appendOperation(t,e),this.onOperation(this,t,h.OPERATION.APPENDCHILD,e,h.OPERATION.REMOVECHILD,null)},_appendOperation:function(t,e){t.parent=this,(t.index=e)?e<this.length?this.children.splice(e,0,t):this.children.push(t):this.children.unshift(t);for(var i=this.length++;e<i;)this.children[i--].index++;this._appendDepth(t,this.depth+1),this._appendCount(t,t.count+1)},_appendDepth:function(t,e){t.depth=e,t.forEachChild(function(t){this._appendDepth(t,e+1)},this)},_appendCount:function(t,e){for(;t=t.parent;)t.count+=e},removeChild:function(t){this._removeOperation(t),this.onOperation(this,t,h.OPERATION.REMOVECHILD,null,h.OPERATION.APPENDCHILD,t.index)},_removeOperation:function(t){for(var e=--this.length;e>t.index;)this.children[e--].index--;t.index?t.index<this.length?this.children.splice(t.index,1):this.children.pop():this.children.shift(),this._appendCount(t,-(t.count+1))},forEachChild:function(t,e,i,s){for(var n=(i=void 0===i?0:i)<(s=void 0===s?this.length:s)?1:-1;i!==s;)t.call(e,this.children[i]),i+=n},getValue:function(){return this.value},setValue:function(t){this._setValueOperation(t)},_setValueOperation:function(t){this.value=t,this._apply()},_apply:function(){for(var t,e=this.value,i=this.values,s=this.texts,n=this.style,o=0,h=0,r=0,a=i.length=0,l=e.length;a<l;a++)"\n"===(t=e[a])?(i.push(e.substring(r,a)),r=a+1,h<o&&(h=o),o=0):(o+=t=d().Utils.measureTextWidth(t,n.font))>n.maxWidth&&(i.push(e.substring(r,a)),r=a,h=n.maxWidth,o=t);for(i.push(e.substring(r)),l=i.length;s.length<l;){var c=new(d().Text)(this.$ctx,0,0);c.getStyle().setFillStyle(n.color).setFont(n.font).setTextAlign("left").setTextBaseline("top"),s.push(c)}for(this.background.setWidth(this.width=n.paddingLeft+n.paddingRight+(h<o?o:h)).setHeight(this.height=n.paddingTop+n.paddingBottom+n.fontSize+(l-1)*n.lineHeight),this.border.setWidth(this.width+2*n.borderOffset).setHeight(this.height+2*n.borderOffset),a=0;a<l;a++)s[a].setText(i[a]);this.halfWidth=this.width/2,this.halfHeight=this.height/2,this.layoutX+=0,this.layoutY+=0},eventmove:function(t,e){return this.isMousein=this.background.isPointInPath(t,e)},select:function(){this.isSelected=!0,this.border.getStyle().setStrokeStyle(this.style.borderColor)},unselect:function(){this.isSelected=this.isMousein=!1,this.border.getStyle().setStrokeStyle(this.style.borderAlpha)},hide:function(){this.draw=d().Utils.noop},show:function(){this.draw=h.prototype.draw},onValueOperation:function(t){this.onOperation(this,null,h.OPERATION.SETVALUE,this.value,h.OPERATION.SETVALUE,t)},beforeOffset:function(){this._x=this.x,this._y=this.y},offset:function(t,e){this.layoutX=this._x+t,this.layoutY=this._y+e},get layoutX(){return this.x},set layoutX(t){this.x=t,this.right=t+this.width,this.cx=t+this.halfWidth},get layoutY(){return this.y},set layoutY(t){this.y=t,this.bottom=t+this.height,this.cy=t+this.halfHeight},get collapse(){return this._collapse},set collapse(t){var e=this._collapse;this._collapseOperation(t),void 0!==e&&e!==t&&this.onOperation(this,null,h.OPERATION.COLLAPSE,t,h.OPERATION.COLLAPSE,e)},_collapseOperation:function(t){this.link._collapse(this._collapse=t)},get count(){return this._count},set count(t){this.link._count(this._count=t)},get length(){return this._length},set length(t){this.link._length(this._length=t)},get first(){return this.children[0]},get last(){return this.children[this.length-1]},get previous(){return this.parent.children[this.index-1]},get next(){return this.parent.children[this.index+1]},onOperation:d().Utils.noop},h.Style=function(t){this.target=t},h.Style.prototype={apply:function(t){this.backgroundColor=t.backgroundColor||"#e2e9f1",this.color=t.color||"#35455b",this.fontSize=t.fontSize||14,this.fontFamily="Open Sans",this.font=this.fontSize+"px "+this.fontFamily,this.lineHeight=Math.floor(4*this.fontSize/3),this.maxWidth=280,this.paddingLeft=t.paddingLeft||.625*this.fontSize,this.paddingRight=t.paddingRight||this.paddingLeft,this.paddingTop=t.paddingTop||.5*this.fontSize,this.paddingBottom=t.paddingBottom||this.paddingTop,this.borderRadius=.3*this.fontSize,this.borderPadding=2,this.borderWidth=2,this._borderOffset=this.borderWidth/2,this.borderOffset=this.borderPadding+this._borderOffset,this.borderColor="#2ebdff",this.borderAlpha=this.borderColor+"80",this._apply()},_apply:function(){var t=this.target,e=t.background,i=t.border,s=t.texts;e.setRadius(this.borderRadius).getStyle().setFillStyle(this.backgroundColor).setLineWidth(this.borderWidth),i.setRadius(this.borderRadius).getStyle().setStrokeStyle(t.isSelected?this.borderColor:this.borderAlpha).setLineWidth(this.borderWidth);for(var n=0,o=s.length;n<o;n++)s[n].getStyle().setFillStyle(this.color).setFont(this.font);t._apply()}},h.Link=function(t){this.target=t,this._link=new r(t.$ctx,0,0,t.children,0,0),this.arc=new(d().Arc)(t.$ctx,0,0,0),this.text=new(d().Text)(t.$ctx,0,0,""),this.line=new(d().Line)(t.$ctx,0,0,0,0),this.style=new h.Link.Style(this),this.isMousein=!1},h.Link.prototype={apply:function(){var t=this.target,e=this.style,i=this.arc;this._link.setStart(t.right,t.cy),i.setStart(t.right+e.spacing,t.cy),this.text.setStart(i.getStartX(),t.cy),this.line.setStart(i.getStartX()-e.arcLineLength/2,t.cy).setEndX(i.getStartX()+e.arcLineLength/2).setEndY(t.cy),t.length?(this._left=t.right,t.collapse?(this._top=t.cy-i.getRadius(),this._right=i.getStartX()+i.getRadius(),this._bottom=t.cy+i.getRadius()):(this._top=t.first.y,this._right=t.first.x,this._bottom=t.last.bottom),this.collidesWith=this._collidesWith):this.collidesWith=this._noCollision},draw:function(){this.target.length&&(this._link.stroke(),this.target.collapse?(this.arc.fillStroke(),this.text.fill()):(this.target.isMousein||this.isMousein)&&(this.arc.fillStroke(),this.line.stroke()))},eventdown:function(){this.target.collapse=!this.target.collapse},eventmove:function(t,e){return 0!==this.target.length&&(this.isMousein!==(this.target.collapse?this.arc.isPointInPath(t,e):t>=this._left&&t<=this._right&&e>=this.target.y&&e<=this.target.bottom)&&this.arc.getStyle().setFillStyle((this.isMousein=!this.isMousein)?this.style.backgroundMousein:this.style.backgroundColor),this.isMousein)},_collidesWith:function(t){return d().Collision.rect(this._left,this._top,this._right,this._bottom,t.getLeft(),t.getTop(),t.getRight(),t.getBottom())},_noCollision:function(){return!1},_count:function(t){this.text.setText(99<t?"...":t+"")},_collapse:function(t){this._link._collapse=t,this.arc.setRadius(t?this.style.arcRadiusCollapse:this.style.arcRadius)},_length:function(t){this._link._length=t}},h.Link.Style=function(t){this.target=t},h.Link.Style.prototype={apply:function(t){this.backgroundColor=t.backgroundColor||"#ecf4f9",this.backgroundMousein=t.backgroundMousein||"#d2dbe2",this.color=t.color||"#35455b",this.lineWidth=t.lineWidth||2,this.spacing=t.spacing||13,this.arcToRadius=t.arcToRadius||8,this.arcRadius=t.arcRadius||6,this.arcRadiusCollapse=t.arcRadiusCollapse||8,this.arcLineLength=t.arcLineLength||4*this.arcRadius/3,this.arcLineWidth=t.arcLineWidth||1,this.font=t.font||"10px Open Sans",this._apply()},_apply:function(){var t=this.target,e=t._link;e.setSpacing(this.spacing),e.setArcToRadius(this.arcToRadius),e.getStyle().setStrokeStyle(this.color).setLineWidth(this.lineWidth),t.arc.setRadius(e._collapse?this.arcRadiusCollapse:this.arcRadius).getStyle().setLineWidth(this.arcLineWidth).setStrokeStyle(this.color).setFillStyle(t.isMousein?this.backgroundMousein:this.backgroundColor),t.text.getStyle().setFont(this.font).setFillStyle(this.color).setTextAlign("center").setTextBaseline("middle"),t.line.getStyle().setLineWidth(this.arcLineWidth).setStrokeStyle(this.color)}},d().Utils.inheritPrototype(r,d().Shape),Object.defineProperties(r.prototype,{process:{value:function(){var t,e,i,s=this.ctx,n=this._sx+this.spacing,o=this._sy,h=this.children;if(s.beginPath(),s.moveTo(this._sx,o),s.lineTo(n,o),!this._collapse)for(t=0;t<this._length;t++)e=(i=h[t]).x-this.ox,i=i.cy-this.oy,Math.abs(i-o)<this.arcToRadius?s.moveTo(n,i):(s.moveTo(n,o),s.arcTo(n,i,e,i,this.arcToRadius)),s.lineTo(e,i)}},setSpacing:{value:function(t){this.spacing=t}},setArcToRadius:{value:function(t){this.arcToRadius=t}}}),h),Selector:(o.prototype={select:function(t,e,i){t?t.isSelected?e?this._unselect(t):i?this._selectRange(this.ctrl,t):this._clear(t):e?this._select(t):i?this.ctrl?this._selectRange(this.ctrl,t):this._select(t):this._clear(t):e||i||this._clear()},isMultiple:function(){return 1<this.selected.length},sideBySide:function(){for(var t=this.selected.length;0<t;)if(this.selected[--t].parent!==this.ctrl.parent)return!1;return!0},forEachSelected:function(t,e){for(var i=0,s=this.selected.length;i<s;i++)this._selected[i]=this.selected[i];for(i=0;i<s;i++)t.call(e,this._selected[i])},onCtrlSelected:d().Utils.noop,onNodeSelected:d().Utils.noop,onClear:d().Utils.noop,_select:function(t){t.select(),this.selected.push(t),null===this.ctrl?this.onCtrlSelected(this.ctrl=t):this.onNodeSelected(t)},_unselect:function(t){t.unselect(),this.selected.splice(this.selected.indexOf(t),1)},_clear:function(t){for(;this.selected.length;)this.selected.pop().unselect();this._shift.length=0,this.ctrl=null,t?this._select(t):this.onClear()},_selectRange:function(t,e){if(e.depth===t.depth&&e!==t){for(;this._shift.length;){var i=this._shift.pop();i.isSelected&&this._unselect(i)}t.parent.forEachChild(function(t){t.isSelected||this._select(t),this._shift.push(t)},this,e.index,t.index),t.isSelected||this._select(t)}},get last(){return this.selected[this.selected.length-1]},get length(){return this.selected.length}},o),Hacker:(n.unit="px",n.prototype={_init:function(){this.border=document.createElement("div"),this.border.appendChild(this.textarea=document.createElement("textarea")),this.deactivate()},_initStyles:function(){var t=this.border.style,e=this.textarea.style;t.position="absolute",t.borderStyle="solid",t.margin="0",e.display="block",e.overflow="hidden",e.outline=e.border=e.resize="none",e.wordWrap=e.whiteSpace="break-spaces",e.wordBreak="break-all",e.boxSizing="border-box",e.margin="0",e.tabSize="1"},_initCallbacks:function(){var t=this.border;t.onmousedown=t.onmousemove=t.onmouseup=t.ontouchstart=t.ontouchmove=t.ontouchend=t.onmouseout=t.ontouchcancel=t.ondblclick=function(t){t.stopPropagation()},t.oncontextmenu=function(t){t.stopPropagation(),t.preventDefault()},t.onkeydown=function(t){var e,i,s,n=t.key;if(this.isActivated())switch(t.stopPropagation(),n){case"s":case"o":t.ctrlKey&&t.preventDefault();break;case"Tab":t.preventDefault();break;case"Escape":this._bind.setValue(this._value),this.deactivate();break;case"Enter":t.ctrlKey?(e=this.getValue(),i=this.selectionStart,s=this.selectionEnd,this.setValue(e.substr(0,i)+"\n"+e.substr(s)),this.selectionEnd=i+1,this._oninput()):t.shiftKey||(t.preventDefault(),this.deactivate())}else(!t.ctrlKey&&1===n.length||t.isComposing||"Process"===n)&&(" "===n&&t.preventDefault(),t.stopPropagation(),this.activate())}.bind(this),t.oninput=this._oninput.bind(this)},appendTo:function(t){t.appendChild(this.border)},bind:function(t){this.isActivated()&&this.deactivate(),this._bind=t,this.textarea.focus()},activate:function(){this.beforeActivate(this._bind),this._isActivated=!0,this.border.style.opacity="1",this.border.style.pointerEvents="auto",this._bindParams(),this._bindStyles(),this._bind.hide(),this.callDraw()},deactivate:function(){this._isActivated=!1,this.border.style.opacity="0",this.border.style.pointerEvents="none",this._bind&&(this._bind.show(),this._bind.getValue()===this._value?this.callDraw():this._bind.onValueOperation(this._value))},isActivated:function(){return this._isActivated},_bindParams:function(){this.follow(),this.setWidth(this._bind.width),this.setHeight(this._bind.height),this.setValue(this._value=this._bind.getValue()),this.textarea.select()},_bindStyles:function(){var t=this.border.style,e=this.textarea.style,i=this._bind.style;t.borderRadius=i.borderRadius+i._borderOffset+n.unit,t.padding=i.borderPadding+n.unit,t.borderWidth=i.borderWidth+n.unit,t.borderColor=i.borderColor,e.backgroundColor=i.backgroundColor,e.color=i.color,e.font=i.font,e.lineHeight=i.lineHeight+n.unit,e.paddingTop=i.paddingTop+.365*i.fontSize-i.lineHeight/2+n.unit,e.paddingLeft=i.paddingLeft+n.unit,e.paddingRight=i.paddingRight+n.unit,e.borderRadius=i.borderRadius+n.unit},_oninput:function(){var t=this._bind;t.setValue(this.getValue()),this.width<t.width&&this.setWidth(t.width),this.height<t.height&&this.setHeight(t.height),this.oninput(t)},setStart:function(t,e){this.border.style.left=(this.x=t)+n.unit,this.border.style.top=(this.y=e)+n.unit},follow:function(){this.setStart(this._bind.borderX,this._bind.borderY)},setWidth:function(t){this.textarea.style.width=(this.width=t)+n.unit},setHeight:function(t){this.textarea.style.height=(this.height=t)+n.unit},getValue:function(){return this.textarea.value},setValue:function(t){this.textarea.value=t},get selectionStart(){return this.textarea.selectionStart},set selectionStart(t){this.textarea.selectionStart=t},get selectionEnd(){return this.textarea.selectionEnd},set selectionEnd(t){this.textarea.selectionEnd=t},callDraw:d().Utils.noop,oninput:d().Utils.noop,beforeActivate:d().Utils.noop},n),Operation:(s.prototype={push:function(t,e,i,s,n,o){this._pop();var h=performance.now();this._stack.push({source:t,target:e,operation:i,newValue:s,reverse:n,oldValue:o,immediate:h-this._timestamp<10}),this._timestamp=h,this._cursor++,this.onMove(t,e,i)},prev:function(){if(this._cursor){var t=this._stack[--this._cursor];for(this._prev(t);t.immediate;)this._prev(t=this._stack[--this._cursor])}},_prev:function(t){t.source[t.reverse](t.target||t.oldValue,t.oldValue),this.onMove(t.source,t.target,t.reverse)},next:function(){if(this._cursor<this._stack.length){var t=this._stack[this._cursor];for(this._next(t);++this._cursor<this._stack.length&&(t=this._stack[this._cursor]).immediate;)this._next(t)}},_next:function(t){t.source[t.operation](t.target||t.newValue,t.newValue),this.onMove(t.source,t.target,t.operation)},clear:function(){this._pop(),this._stack.length=this._cursor=this._stamp=this._timestamp=0},_pop:function(){for(;this._stack.length>this._cursor;){var t=this._stack.pop();this.onPop(t.source,t.target,t.operation)}},pause:function(t){this.push=t?d().Utils.noop:s.prototype.push},hasChanged:function(){return this._cursor!==this._stamp},stamp:function(){this._stamp=this._cursor},onMove:d().Utils.noop,onPop:d().Utils.noop},s)},methods:{init:function(){this._init(),this._initStyles(),this._initCallbacks(),this._layout(this.root),this.selector.select(this.root)},_init:function(){this._spaceHolding=!1,this._garbage=[],this._arrowKey=["ArrowLeft","ArrowRight","ArrowUp","ArrowDown"],this._hotKey=["Tab","Enter","Backspace","Delete","x","c","v","d","e"],this._queue=[],this._stack=[],this.background=new(d().Rect)(this.$ctx,0,0),this.selector=new this.Selector,this.hacker=new this.Hacker,this.hacker.appendTo(this.$wrapper),this.input=document.createElement("input"),this.input.type="file",this.operation=new this.Operation,this.root=this.parse(this.data),this.point.locate(this.$width/2,this.$height/2),this.point.animation=new(d().Animation)(this.$raf,200,0,function(){this._before.copy(this._offset)}.bind(this.point),function(t){var e=d().Utils.ease.out.quad;this.set(this._before.x+this._delta.x*e(t),this._before.y+this._delta.y*e(t))}.bind(this.point),function(){this.beforeUpdate()}),this.box=new(d().Rect)(this.$ctx,0,0,0,0),this._nextDraw=d().Utils.nextTick(this.draw),this.imageData=new(d().ImageData)(this.$ctx,0,0)},_initStyles:function(){this.background.getStyle().setFillStyle(this.style.backgroundColor),this.box.getStyle().setFillStyle(this.style.boxBackgroundColor).setStrokeStyle(this.style.boxBorderColor).setLineWidth(2),this._style(this.root)},_initCallbacks:function(){this.selector.onCtrlSelected=function(t){this.hacker.bind(t),this._offsetToScreen(t)}.bind(this),this.selector.onNodeSelected=function(t){this._offsetToScreen(t),this.hacker.isActivated()&&this.selector.select(t)}.bind(this),this.selector.onClear=function(){this.hacker.isActivated()?this.hacker.deactivate():this._nextDraw()}.bind(this),this.hacker.callDraw=function(){this.draw()}.bind(this),this.hacker.oninput=function(t){this._offsetToScreen(t,t.right>this.$width||t.bottom>this.$height)}.bind(this),this.hacker.beforeActivate=function(t){this.selector.isMultiple()&&this.selector.select(t)}.bind(this),this.input.onchange=function(t){this.load(t.target.files.item(0)),t.target.value=""}.bind(this),this.point.onOffsetChanged=function(t,e){this._offset(t,e)}.bind(this),history.pushState(null,null,document.URL),window.addEventListener("popstate",function(){history.pushState(null,null,document.URL)}),window.addEventListener("beforeunload",function(t){if(this.operation.hasChanged())return t.preventDefault(),t.returnValue="Are you sure you want to exit?"}.bind(this),{capture:!0}),this.Node.setOnOperation(function(){this.operation.push.apply(this.operation,arguments)}.bind(this)),this.operation.onMove=function(t,e,i){switch(i===this.Node.OPERATION.APPENDCHILD&&this._style(e),this._layout(this.root),i){case this.Node.OPERATION.APPENDCHILD:this.selector.select(e);break;case this.Node.OPERATION.REMOVECHILD:this.selector.select(e.index?e.previous:e.parent.length?e.parent.first:e.parent);break;case this.Node.OPERATION.COLLAPSE:this.selector.select(t);break;case this.Node.OPERATION.SETVALUE:this.draw()}}.bind(this),this.operation.onPop=function(t,e,i){i===this.Node.OPERATION.APPENDCHILD?this._gc(e):i===this.Node.OPERATION.REMOVECHILD&&this._release(e)}.bind(this)},_style:function(t){var e=this.style;this._walk(t,function(t){t.style.apply(1<t.depth?e.subTopic:1===t.depth?e.mainTopic:e.centralTopic),t.link.style.apply(t.depth?e.mainLink:e.centralLink)})},_layout:function(t){t.layoutX=0,t.layoutY=0,this._layoutCheck(t)&&this._layoutChildren(t),this._bfs(t,function(t){var e;t.beforeOffset(),this._layoutCheck(t)&&(e=t.cy-(t.first.cy+t.last.cy)/2,t.forEachChild(function(t){t.layoutY+=e}))}),this.point.add(0,0)},_layoutCheck:function(t){return t.length&&!t.collapse},_layoutChildren:function(e){var i,s,t=e.first,n=e.last,o=e.depth?(i=this.style.spacing,this.style.verticalSpacing):(i=this.style.centralSpacing,this.style.centralVerticalSpacing);e.forEachChild(function(t){t.layoutX=e.right+i,t.layoutY=t.index?t.previous.bottom+o:0}),s=e.cy-(t.cy+n.cy)/2,e.forEachChild(function(t){t.layoutY+=s}),e.depth&&(t=t.y-e.y,n=n.bottom-e.bottom,t<0?e.layoutTop=0:(e.layoutTop=-t,t=0),0<n?e.layoutBottom=0:(e.layoutBottom=-n,n=0),(t||n)&&this._layoutParent(e,t,n)),e.forEachChild(function(t){this._layoutCheck(t)&&this._layoutChildren(t)},this)},_layoutParent:function(e,t,i){var s=e.parent,n=s.first,o=s.last,h=n.y+o.bottom,r=t;s.forEachChild(function(t){return t===e?r=i:void(t.layoutY+=r)}),s.depth&&(t+=h=(h-(n.y+o.bottom))/2,i+=h,s.layoutTop<0&&(s.layoutTop<t?(s.layoutTop-=t,t=0):(t-=s.layoutTop,s.layoutTop=0)),0<s.layoutBottom&&(s.layoutBottom>i?(s.layoutBottom-=i,i=0):(i-=s.layoutBottom,s.layoutBottom=0)),this._layoutParent(s,t,i))},_offset:function(e,i){var t=this.root;e-=t.width/2,i-=t.height/2,this._bfs(t,function(t){t.offset(e,i),t.apply()}),this._bfs(t,function(t){t.link.apply()}),this.hacker.isActivated()&&this.hacker.follow()},_offsetToScreen:function(t,e){var i=this.point,s=i.animation,n=t.depth?this.style.spacing:this.style.centralSpacing;!e&&t.collidesWith(this.background)?i.delta(t.right>this.$width?this.$width-n-t.right:t.x<n?n-t.x:0,t.bottom>this.$height?this.$height-n-t.bottom:t.y<n?n-t.y:0):i.delta(this.$width/2-t.cx,this.$height/2-t.cy),i.isDelta()?s.start():s.isRunning()?(s.beforeUpdate(),s.stop()):void 0===e&&this._nextDraw()},resize:function(){this.background.setWidth(this.$width).setHeight(this.$height)},update:function(t,e){this.point.animation.update(e)},draw:function(){this.background.fill(),this._bfs(this.root,function(t){t.link.collidesWith(this.background)&&t.link.draw(),t.collidesWith(this.background)&&t.draw()}),this.box.fillStroke()},_walk:function(t,e){e.call(this,t),t.forEachChild(function(t){this._walk(t,e)},this)},_bfs:function(t,e){var i,s=this._queue;for(s.unshift(t);s.length;)e.call(this,i=s.shift()),i.collapse||i.forEachChild(function(t){s.push(t)})},_dfs:function(t,e){var i,s,n,o=this._stack;for(o.push(t);o.length;)for(e.call(this,i=o.pop()),s=i.children,n=i.length;0<n;)o.push(s[--n])},_gc:function(t){t._recursive?(delete t._recursive,this._gcRecursive(t)):this._garbage.push(t)},_release:function(t){t=this._garbage.indexOf(t);-1!==t&&this._garbage.splice(t,1)},_gcRecursive:function(t){this._walk(t,function(t){this._garbage.push(t)})},_gcNode:function(t,e){var i=this._garbage.pop();return i?i.reset():i=new this.Node(this.$ctx),i.value=t,i.collapse=!!e,i}},events:{eventdown:function(t,e){switch(this.mouse.type=e){case this.mouse.left:this._eventmove(t.$x,t.$y),this._link?(t.preventDefault(),this._link.eventdown()):(this.selector.select(this._node,t.ctrlKey,t.shiftKey),this._node||t.ctrlKey||t.shiftKey?(t.preventDefault(),this._node===this.root&&this.point.eventdown()):(this.$setCursor("default"),this.box.setStart(t.$x,t.$y)));break;case this.mouse.right:t.preventDefault(),this.$setCursor("grabbing"),this.hacker.isActivated()&&this.hacker.deactivate(),this.point.eventdown()}},eventmove:d().Utils.nextTick(function(t,e){if(this.mouse.type===e)switch(e){case this.mouse.none:this._eventmove(t.$x,t.$y);break;case this.mouse.left:this._node?this._node===this.root&&(this.point.eventmove(t.$moveX,t.$moveY),this.draw()):null===this._link&&(t.$moveX||t.$moveY)&&(this.box.setWidth(t.$moveX).setHeight(t.$moveY),this.selector.select(null),this._bfs(this.root,function(t){t.collidesWith(this.box)&&this.selector.select(t,!0)}));break;case this.mouse.right:this.point.eventmove(t.$moveX,t.$moveY),this.draw()}}),_eventmove:function(e,i){var t=this._node,s=this._link;this._node=this._link=null,this._bfs(this.root,function(t){t.eventmove(e,i)&&(this._node=t),t.link.eventmove(e,i)&&(this._link=t.link)}),t===this._node&&s===this._link||(this.$setCursor(this._node||this._link?"pointer":"grab"),this.draw())},eventup:function(){this.mouse.type=this.mouse.none,"pointer"!==this.$getCursor()&&this.$setCursor("grab"),(this.box.getWidth()||this.box.getHeight())&&(this.box.setWidth(0).setHeight(0),this.draw())},keydown:function(t){t.preventDefault();var e=t.key;-1!==this._arrowKey.indexOf(e)?t.shiftKey?this._shiftArrow(e):this._ctrlArrow(e,t.ctrlKey):-1!==this._hotKey.indexOf(e)?this._hotkey(e,t.ctrlKey,t.shiftKey):t.ctrlKey?this._hotkeyCtrl(e):"space"===t.code.toLowerCase()&&(this._spaceHolding=!0)},keyup:function(t){"space"===t.code.toLowerCase()&&(this._spaceHolding=!1)},_shiftArrow:function(t){var e,i,s=this.selector.ctrl;if(null!==s&&null!==(e=s.parent))switch(t){case"ArrowLeft":e.depth&&(e.removeChild(s),e.parent.insertChild(s,e.index+1));break;case"ArrowRight":s.index&&(i=s.previous,e.removeChild(s),i.collapse&&(i.collapse=!1),i.appendChild(s));break;case"ArrowUp":s.index&&(e.removeChild(s),e.insertChild(s,s.index-1));break;case"ArrowDown":s.index+1<e.length&&(e.removeChild(s),e.insertChild(s,s.index+1))}},_ctrlArrow:function(t,e){var i,s,n,o,h=this.selector,r=h.last,a=1/0;if(void 0!==r){switch(t){case"ArrowLeft":i=r.parent;break;case"ArrowRight":if(r.collapse)return;for(s=0;s<r.length&&(o=r.children[s],(n=Math.min(Math.abs(r.cy-o.y),Math.abs(r.cy-o.bottom)))<a);s++)a=n,i=o;break;case"ArrowUp":r.index?i=r.previous:1<r.depth&&this._bfs(this.root,function(t){r.y>t.y&&r.x<=t.right&&r.right>=t.x&&(n=r.y-t.y)<a&&(a=n,i=t)});break;case"ArrowDown":r.index+1<(r.parent&&r.parent.length)?i=r.next:1<r.depth&&this._bfs(this.root,function(t){t.y>r.y&&r.x<=t.right&&r.right>=t.x&&(n=t.y-r.y)<a&&(a=n,i=t)})}i&&(e&&i.isSelected?(h.select(r,!0),this.draw()):h.select(i,e))}},_hotkey:function(t,e,i){var s,n,o=this.selector,h=o.ctrl;if(null!==h)switch(t){case"Tab":h.collapse&&(h.collapse=!1),s=this._gcNode(this.topic(h.depth)+(h.length+1)),h.appendChild(s);break;case"Enter":if(null===(n=h.parent))return;e?o.sideBySide()&&(s=this._gcNode(this.topic(n.depth)+(n.length-o.length+1)),o.forEachSelected(function(t){null===s.parent&&n.insertChild(s,t.index),n.removeChild(t),s.appendChild(t)})):(s=this._gcNode(this.topic(n.depth)+(n.length+1)),n.insertChild(s,h.index+!i));break;case"Backspace":case"Delete":if(null===(n=h.parent))return;if(e)for(h.collapse&&(h.collapse=!1);s=h.first;)h.removeChild(s),n.insertChild(s,h.index);n.removeChild(h);break;case"x":this._hotkey("c"),this._hotkey("Delete");break;case"c":navigator.clipboard.writeText(this.serialize(h,this.format.xmind));break;case"v":navigator.clipboard.readText().then(function(t){s=this.deserialize(t,this.format.xmind),h.collapse&&(h.collapse=!1),h.appendChild(s)}.bind(this));break;case"d":if(navigator.clipboard.writeText(this.serialize(h,this.format.markdown)),null===(n=h.parent))return;navigator.clipboard.readText().then(function(t){n.insertChild(this.deserialize(t,this.format.markdown),h.index+1)}.bind(this));break;case"e":h.length&&(h.collapse=!h.collapse)}},_hotkeyCtrl:function(t){switch(t){case"a":this.selector.select(this.root);var e=0;this._bfs(this.root,function(t){e++,this.selector.select(t,!0)}),this.selector.select(this.root,!0),console.log("已选节点总数："+e);break;case"q":this.selector.select(this.root);break;case"o":this.operation.hasChanged()&&confirm("需要保存您所做的更改吗？")?this._hotkeyCtrl("s"):this.input.click();break;case"s":this.operation.stamp(),this.save();break;case"S":this.saveAsImage(this.root);break;case"z":this.operation.prev();break;case"y":case"Z":this.operation.next()}},mousedown:function(t){let e=t.buttons;this._spaceHolding&&e===this.mouse.left&&(e=this.mouse.right),this.eventdown(t,e)},mousemove:function(t){let e=t.buttons;this._spaceHolding&&e===this.mouse.left&&(e=this.mouse.right),this.eventmove(t,e)},mouseup:function(){this.eventup()},dblclick:function(){null===this._link&&(this._node?(this.selector.select(this._node),this.hacker.activate()):console.log(this._garbage.length===d().Utils.unique(this._garbage).length?"垃圾回收系统正常":"垃圾回收系统异常"))},contextmenu:function(t){},wheel:function(t){t.ctrlKey||(t.preventDefault(),t.shiftKey?this.point.add(-t.deltaY,0):this.point.add(-t.deltaX,-t.deltaY),this.draw())}},functions:{parse:function(t,e){void 0===e&&(e=this._gcNode(t.value,t.collapse));for(var i=0,s=t.children,n=s.length;i<n;i++){var o=s[i],h=this._gcNode(o.value,o.collapse);e.appendChild(h),this.parse(o,h)}return e},stringify:function(t,i){return void 0===i&&(i={value:t.getValue(),children:[]}),t.collapse&&(i.collapse=!0),t.forEachChild(function(t){var e={value:t.getValue(),children:[]};i.children.push(e),this.stringify(t,e)},this),i},deserialize:function(t,e){this.operation.pause(!0);for(var i,s,n,o,h,r=t.split(e.regex),a=r.length,l=0,c=0;c<a;c++){if(n=r[c],e.prefix)o=n.indexOf(e.prefix);else for(o=0;n.charAt(o)===e.separate;)o++;if(h=this._gcNode(n.substring(o+e.prefix.length).replace(/\r\n/g,"\n")),o){if(l<o)l=o;else for(s=s.parent;o<l;)s=s.parent,l-=e.indent;s.appendChild(h)}else i=h;s=h}return this.operation.pause(!1),i._recursive=!0,i},serialize:function(e,i){var s="";return this._walk(e,function(t){s+=i.separate.repeat((t.depth-e.depth)*i.indent)+i.prefix+t.value+i.suffix}),s.substr(0,s.length-i.suffix.length)},saveAsImage:function(t){var e,i=1/0,s=1/0,n=-1/0,o=-1/0;this._bfs(t,function(t){t.x<i&&(i=t.x),t.y<s&&(s=t.y,e=t),t.right>n&&(n=t.right),t.bottom>o&&(o=t.bottom)});var h=this.style.centralSpacing,r=h-t.x,a=h-e.y,l=2*h+n-i,c=2*h+o-s,h=this.$dpr;this.point.add(r,a),this.box.getMatrix().setOffset(r,a),this.$resize(l,c),this.imageData.setImageData(0,0,l*h,c*h).saveAsImage(t.getValue(),"image/jpeg"),this.point.add(-r,-a),this.box.getMatrix().setOffset(0,0),this.$resize()},load:function(t){t&&(void 0===this._reader&&(this._reader=new FileReader,this._reader.onload=function(t){this._gcRecursive(this.root),this.operation.clear(),this.operation.pause(!0),this.root=this.parse(JSON.parse(t.target.result)),this.operation.pause(!1),this._style(this.root),this._layout(this.root),this.selector.select(this.root)}.bind(this)),document.title=t.name,this._reader.readAsText(t))},save:function(){var t=d().Utils._a,e=URL.createObjectURL(new Blob([JSON.stringify(this.stringify(this.root))],{type:"text/plain"}));t.href=e,t.download=document.title=this.root.getValue()+".jmind",t.click(),URL.revokeObjectURL(e)}},callbacks:{}});function s(){this._stack=[],this.clear()}function n(){this._init(),this._initStyles(),this._initCallbacks()}function o(){this.selected=[],this._selected=[],this._shift=[],this.ctrl=null}function h(t){this._serialId=h._serialId++,this.$ctx=t,this.x=this.y=this.width=this.height=this.borderX=this.borderY=0,this.parent=null,this.children=[],this.index=0,this.depth=0,this.value="",this.values=[],this.background=new(d().RoundRect)(this.$ctx,0,0,0,0,0),this.border=new(d().RoundRect)(this.$ctx,0,0,0,0,0),this.texts=[],this.isMousein=!1,this.isSelected=!1,this.style=new h.Style(this),this.link=new h.Link(this),this.count=0,this.length=0}function r(t,e,i,s,n,o){d().Shape.call(this,t,e,i,n,o),this.children=s}}}]);